<!--
    
    check out the code at:
    https://github.com/laurensdewaele/blog

    -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="Laurens Dewaele" />
    <meta name="description" content="" />
    <meta
      name="keywords"
      content=", blog, software, software engineering, frontend development, development, laurens dewaele"
    />
    <!--    TODO: Set theme color-->
    <meta name="theme-color" content="" />
    <meta name="color-scheme" content="normal" />
    <meta name="robots" content="index,follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="./assets/css/styles.css" rel="stylesheet" />
    <link
      href="https://myCDN.com/prism@v1.x/themes/prism.css"
      rel="stylesheet"
    />
    <title>The creation of my blog, aka my own static site generator</title>
  </head>
  <body>
    <nav>
      <a href="./index.html"><h1>laurens.codes</h1></a>
    </nav>
    <main>
      <article class="article-blogpost-page">
        <header>
          <div>
            <h2>The creation of my blog, aka my own static site generator</h2>
            <p>
              <time datetime="2019-09-16">
                16 Sep 2019
              </time>
            </p>
          </div>
          <div class="svg-container">
            <svg
              aria-labelledby="svgDesc"
              width="80"
              height="80"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <desc id="svgDesc">build icon</desc>
              <path fill="#2B2B2B" d="M0 0h80v80H0z" />
              <path
                stroke="#000"
                stroke-opacity=".3"
                stroke-width="2"
                d="M1 1h78v78H1z"
              />
              <g filter="url(#filter0_d)">
                <path
                  d="M18.736 56.752l4.608 4.63c.757.824 1.957.824 2.777 0l18.18-18.265c4.609 1.776 10.037.76 13.825-3.044 3.977-3.996 4.987-10.02 2.588-14.84l-8.774 8.625-5.997-6.025 8.585-8.625c-4.798-2.22-10.795-1.395-14.771 2.6-3.851 3.869-4.798 9.26-3.03 13.889l-18.18 18.265c-.758.57-.758 1.966.189 2.79z"
                  fill="url(#paint0_linear)"
                />
                <path
                  d="M19.09 56.4l-.012-.013-.014-.012a1.614 1.614 0 01-.563-1.136c-.018-.399.129-.714.346-.878l.029-.021.025-.026L37.08 36.05l.228-.23-.115-.301c-1.7-4.45-.792-9.632 2.917-13.358 3.64-3.657 9.047-4.553 13.543-2.784l-8.066 8.103-.35.353.35.353 5.997 6.024.35.353.355-.349 8.268-8.127c1.915 4.508.872 9.957-2.786 13.633-3.647 3.663-8.866 4.636-13.29 2.93l-.305-.117-.23.231-18.18 18.265c-.633.636-1.503.615-2.055.014l-.007-.007-.007-.007-4.608-4.63z"
                  stroke="#000"
                  stroke-opacity=".77"
                />
              </g>
              <defs>
                <linearGradient
                  id="paint0_linear"
                  x1="35.5"
                  y1="68.5"
                  x2="120"
                  y2="-18.5"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#fff" />
                  <stop offset="1" stop-color="#fff" stop-opacity="0" />
                </linearGradient>
                <filter
                  id="filter0_d"
                  x="14"
                  y="18"
                  width="52"
                  height="52"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                  />
                  <feOffset dy="4" />
                  <feGaussianBlur stdDeviation="2" />
                  <feColorMatrix
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                  />
                  <feBlend
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow"
                  />
                  <feBlend
                    in="SourceGraphic"
                    in2="effect1_dropShadow"
                    result="shape"
                  />
                </filter>
              </defs>
            </svg>
          </div>
        </header>
        <section>
          <h3>What</h3>
          <p>
            I wanted a blog where I could post my code learnings. It needed to
            be as simple as possible, but also perform reasonably well. My
            <strong>requirements</strong>:
          </p>
          <ul>
            <li>
              I only want to write content, thus automating everything else.
            </li>
            <li>Images need to be responsive.</li>
            <li>Svg's need to be inlined.</li>
            <li>Make it an SPA. This is a nice to have.</li>
          </ul>
          <h3>How</h3>
          <p>
            There's tons of tools available to make blog websites. However, if
            you're a developer, especially a frontend developer, I'm of the
            opinion that you have to build it yourself. That leaves out
            WordPress and the likes.
          </p>
          <p>
            Then there's great stuff available for building blogs with modern js
            frameworks, such as <a href="https://www.gatsbyjs.org/">Gatsby</a>.
            It's quick and easy (if you're proficient in those frameworks). But,
            it comes with a bunch of client side Javascript that is totally
            unnecessary.
          </p>
          <p>
            Then there's Hugo, Jekyll, and the one that fits my needs the most,
            <a href="https://www.11ty.io/docs/">eleventy</a>. The thing is, I
            feel like I'm constantly having to learn new APIs instead of
            actually coding. I'm tired of digging into documentation to make the
            thing do what I want it to do.
          </p>
          <p>
            For <strong>simple enough stuff</strong> like a blog, I'd much
            rather do it all myself.
          </p>
          <h3>Design</h3>
          <p>Let's not forget design. I'm a noob but love to tinker with it.</p>
          <p>LOL</p>
          <p>
            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_1_w_1200.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_1_w_500.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_1_w_1200.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_1_w_500.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_1_w_1200.png" alt="design 1" />
            </picture>
          </p>
          <p>
            I envisioned these brackets to slide open and go to the sides when
            first visiting the page. Almost went with these next ones (without
            the ugly AF brackets though), but it didn't feel simple enough.
          </p>
          <p>
            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_2_w_1200.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_2_w_500.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_2_w_1200.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_2_w_500.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_2_w_1200.png" alt="design 2" />
            </picture>

            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_3_w_1200.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_3_w_500.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_3_w_1200.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_3_w_500.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_3_w_1200.png" alt="design 3" />
            </picture>
          </p>
          <p>
            In an attempt to make it simple and clean, I made these. They're
            suuuuper boring though.
          </p>
          <p>
            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_6_w_360.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_6_w_360.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_6_w_360.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_6_w_360.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_6_w_360.png" alt="design 4" />
            </picture>

            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_7_w_1200.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_7_w_500.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_7_w_1200.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_7_w_500.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_7_w_1200.png" alt="design 5" />
            </picture>
          </p>
          <p>Ah, these feel semi alright.</p>
          <p>
            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_8_w_1200.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_8_w_500.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_8_w_1200.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_8_w_500.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_8_w_1200.png" alt="design 6" />
            </picture>

            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_9_w_1200.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_9_w_500.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_9_w_1200.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_9_w_500.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_9_w_1200.png" alt="design 7" />
            </picture>

            <picture>
              <source
                type="image/webp"
                srcset="./assets/images/design_10_w_360.webp"
                media="(min-width: 500px)"
              />
              <source
                type="image/webp"
                srcset="./assets/images/design_10_w_360.webp"
                media="(max-width: 500px)"
              />
              <source
                srcset="./assets/images/design_10_w_360.png"
                media="(min-width: 500px)"
              />
              <source
                srcset="./assets/images/design_10_w_360.png"
                media="(max-width: 500px)"
              />
              <img src="./assets/images/design_10_w_360.png" alt="design 8" />
            </picture>
          </p>
          <p>
            I felt the colors were off a bit, and something else didn't feel
            quite right. So I went over to a discord UI channel to ask for
            feedback. They rightfully pointed out that I should not use a dark
            theme for large chunks of text. So I changed it to the current
            design you're viewing now ðŸ™‚.
          </p>
          <h3>Code</h3>
          <p>
            Initially, I started out in bash because I wanted to learn a new
            language. It quickly turned out to be too time consuming. Perl or
            Python are much better candidates for the job. I decided to skip my
            own advice of picking the right tool for the job, and going with
            what I know already, Javascript.
          </p>
          <p>To quote my friend:</p>
          <blockquote>
            <p>A good developer is a developer who gets things done.</p>
          </blockquote>
          <h4>Implementing the requirements</h4>
          <ol>
            <li>
              <p>I should only worry about writing content</p>
              <p>
                Everyone and everything is using Markdown to write their content
                at the moment, so I went with it. This means writing my content
                in
                <code>.md</code> files and then converting them to HTML.
              </p>
              <p>
                However, looking back on my decision, I'm not quite convinced.
              </p>
              <p>Pros of writing markdown:</p>
            </li>
          </ol>
          <ul>
            <li>
              <p>
                I, as a frontend developer, do not have to concern myself with
                cumbersome HTML tags ðŸ˜„.
              </p>
            </li>
            <li>
              <p>Euhâ€¦</p>
              <p>Cons:</p>
            </li>
            <li>
              <p>
                I have to write scripts to convert the .md files to .html.
                Conversion can do unwanted things. I do not know how the package
                (<a href="https://github.com/showdownjs/showdown">showdown</a>)
                works.
              </p>
            </li>
            <li>
              <p>
                I had to learn a syntax I wasn't completely familiar with. I
                referenced this
                <a
                  href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet"
                  >markdown cheat sheet</a
                >
                constantly (How much traffic would this repo get? ðŸ¤”ðŸ˜ƒ).
              </p>
            </li>
          </ul>
          <ol>
            <li>
              <p>Images need to be responsive</p>
              <p>
                This means creating 4 versions of each image. Mobile, mobile
                webP, desktop, desktop webP. After creation, optimize the
                images.
              </p>
            </li>
            <li>
              <p>Svg's need to be inlined</p>
              <p>
                This means you have no extra network request fetching the image.
                It's not the right technique if you use the same svg frequently.
              </p>
            </li>
            <li>
              <p>Make it a single page app</p>
              <p>
                This means, when you're on the index page, and you click on a
                blogpost, you don't want to load another external recourse
                (blogpost.html), thus refreshing the page. Or the other way
                around (blogpost -&gt; index).
              </p>
              <p>How I would do it:</p>
            </li>
          </ol>
          <ul>
            <li>Replace all the anchor tags with functions</li>
            <li>
              Create a blogposts.json that contains all the needed information
              to construct the heading and content of a blogpost
            </li>
            <li>Lazy load that file on the initial load.</li>
            <li>
              When you click on a blogpost on the index.html page, delete all
              other blogposts with js, read the needed content from the
              blogposts.json file and inject it into the html.
            </li>
          </ul>
          <h4>After the fact</h4>
          <p>A walkthrough of the code:</p>
          <ul>
            <li>
              Ask the user the filename of the markdown file to convert, the
              keywords of the blogpost, and a description.
            </li>
          </ul>
          <pre><code class="javascript language-javascript">function getFile() {
  return new Promise(async (resolve, reject) =&gt; {
    try {
      const { filename } = await prompts({
        type: "text",
        name: "filename",
        message: `Enter the draft blogpost filename that's ready (without extension)`
      });

      const file = `../content_draft/${filename}.md`;
      if (!fs.existsSync(file)) {
        throw new Error(`${filename}.md not present in ./content_draft`);
      }

      resolve({ file, filename });
    } catch (e) {
      reject(e);
    }
  });
}
</code></pre>
          <ul>
            <li>Convert the markdown file.</li>
          </ul>
          <pre><code class="javascript language-javascript">function convertMarkdownToHtml(markdown) {
  const converter = new showdown.Converter({
    noHeaderId: true,
    headerLevelStart: 2
  });
  const html = converter.makeHtml(markdown);
  return runPrettierOnHtml(html);
}
</code></pre>
          <ul>
            <li>
              Extract the created date, title and images from the html file.
            </li>
          </ul>
          <pre><code class="javascript language-javascript">function extractCreatedDate(file) {
  const { birthTime } = fs.statSync(file);
  return moment(birthTime).format("YYYY-MM-DD");
}

const title = markdownConversionHtml.match(/&lt;h2&gt;\n?(.*)\n?&lt;\/h2&gt;/)[1];

function findAllImages(html) {
  const foundImagesWithCapturingGroups = [
    ...html.matchAll(/&lt;img src="(.*)" alt="(.*)" \/&gt;/g)
  ];
  return foundImagesWithCapturingGroups;
}
</code></pre>
          <ul>
            <li>Create 4 versions of the same image for responsiveness.</li>
          </ul>
          <pre><code class="javascript language-javascript">function resizeAndCreateWebp(inputPath, outputPath, webPOutputPath, width) {
  return new Promise((resolve, reject) =&gt; {
    sharp(inputPath)
      .resize({ width })
      .toFile(outputPath)
      .then(_ =&gt; {
        sharp(outputPath)
          .webp({ lossless: true })
          .toFile(webPOutputPath)
          .then(_ =&gt; {
            resolve({
              originalFormat: outputPath,
              webP: webPOutputPath
            });
          })
          .catch(e =&gt; {
            reject(e);
          });
      })
      .catch(e =&gt; {
        reject(e);
      });
  });
}
</code></pre>
          <ul>
            <li>Optimize those images</li>
          </ul>
          <pre><code class="javascript language-javascript">function optimizeImages(images) {
  const svgImages = images.filter(image =&gt; /svg$/.test(image));
  const jpegImages = images.filter(image =&gt; /jpe?g$/.test(image));
  const pngImages = images.filter(image =&gt; /png$/.test(image));
  const webPImages = images.filter(image =&gt; /webp$/.test(image));

  const destination = "../website/assets/images";

  const promises = [
    imagemin(svgImages, { destination, plugins: [imageminSvgo({})] }),
    imagemin(jpegImages, { destination, plugins: [imageminJpegtran()] }),
    imagemin(pngImages, {
      destination,
      plugins: [imageminPngquant({ strip: true })]
    }),
    imagemin(webPImages, {
      destination,
      plugins: [imageminWebp({ quality: 80 })]
    })
  ];

  return new Promise((resolve, reject) =&gt; {
    Promise.all(promises)
      .then(f =&gt; {
        console.log("Optimization successful");
        resolve();
      })
      .catch(e =&gt; {
        reject(e);
      });
  });
}
</code></pre>
          <ul>
            <li>
              Create a blogpost.html file and the blogpost article html for
              injecting into the index.html
            </li>
          </ul>
          <pre><code class="javascript language-javascript">function createBlogHtml(
  markdownConversionHtml,
  imagesWithHtml,
  description,
  keywords,
  svg,
  title,
  createdDate
) {
  const htmlWithResponsiveImages = runPrettierOnHtml(
    insertResponsiveImages(markdownConversionHtml, imagesWithHtml)
  );
  const htmlWithoutHeaderAndSvg = removeHeaderAndSvgFromHtml(
    htmlWithResponsiveImages
  );
  const articleHtml = runPrettierOnHtml(
    createArticle(svg, title, createdDate, htmlWithoutHeaderAndSvg)
  );
  const blogHtml = runPrettierOnHtml(
    injectBlogIntoGenericHtml(
      htmlWithoutHeaderAndSvg,
      description,
      keywords,
      svg,
      title,
      createdDate
    )
  );
  return { articleHtml, blogHtml };
}

function injectBlogIntoGenericHtml(
  htmlWithoutHeaderAndSvg,
  description,
  newKeywords,
  svg,
  title,
  createdDate
) {
  const keywords = `${newKeywords}, ${standardKeywords}`;
  const content = createArticle(
    svg,
    title,
    createdDate,
    htmlWithoutHeaderAndSvg
  );
  return getGenericHtml(description, keywords, title, content);
}

function createArticleHeader(svg, title, createdDate, content) {
  const formattedDate = moment(createdDate).format("DD MMM YYYY");
  const isForIndexPage = !!!content;
  return `
  &lt;article class="${
    isForIndexPage ? "article-index-page" : "article-blogpost-page"
  }"&gt;
    &lt;header&gt;
      &lt;div&gt;
        &lt;h2&gt;${title}&lt;/h2&gt;
        &lt;p&gt;
          &lt;time datetime="${createdDate}"&gt;
            ${formattedDate}
          &lt;/time&gt;
        &lt;/p&gt;
      &lt;/div&gt;
      &lt;div class="svg-container"&gt;
        ${svg}
      &lt;/div&gt;
    &lt;/header&gt;
    ${isForIndexPage ? "" : content}
  &lt;/article&gt;
`;
}

function createArticle(svg, title, createdDate, htmlWithoutHeaderAndSvg) {
  const content = `&lt;section&gt;${htmlWithoutHeaderAndSvg}&lt;/section&gt;`;
  return createArticleHeader(svg, title, createdDate, content);
}

function getGenericHtml(description, keywords, title, content) {
  return `
    &lt;!--

    check out the code at:
    https://github.com/laurensdewaele/blog
    --&gt;

    &lt;!DOCTYPE html&gt;
    &lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;meta name="author" content="Laurens Dewaele" /&gt;
        &lt;meta name="description" content="${description}" /&gt;
        &lt;meta name="keywords" content="${keywords}" /&gt;
        &lt;!--    TODO: Set theme color--&gt;
        &lt;meta name="theme-color" content="" /&gt;
        &lt;meta name="color-scheme" content="normal" /&gt;
        &lt;meta name="robots" content="index,follow" /&gt;
        &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;
        &lt;link href="./assets/css/styles.css" rel="stylesheet"&gt;
        &lt;title&gt;${title}&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;nav&gt;
            &lt;a href="./index.html"&gt;&lt;h1&gt;laurens.codes&lt;/h1&gt;&lt;/a&gt;
        &lt;/nav&gt;
        &lt;main&gt;
            ${content}
        &lt;/main&gt;
        &lt;footer&gt;
            &lt;p&gt;
                a blog &lt;a href="./about.html"&gt;about&lt;/a&gt; software development
            &lt;/p&gt;
        &lt;/footer&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    `;
}
</code></pre>
          <ul>
            <li>
              Save blogpost into a blogposts.json file. This for eventually
              adding a SPA feel to the website and for rebuilding the html if
              you want to change the generic html.
            </li>
          </ul>
          <pre><code class="javascript language-javascript">const blogpost = {
  title,
  keywords,
  description,
  filename,
  articleHtml: minify(articleHtml),
  articleHeaderHtml: minify(articleHeaderHtml)
};

const blogs = getBlogs();
blogs.push(blogpost);
writeBlogsToJSON(blogs);
</code></pre>
          <p>
            Full code is available @
            <a href="https://github.com/laurensdewaele/blog">github</a>.
          </p>
        </section>
      </article>
    </main>
    <footer>
      <p>a blog <a href="./about.html">about</a> software development</p>
    </footer>
    <script src="https://myCDN.com/prism@v1.x/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-javascript.min.js"></script>
  </body>
</html>
